---
title: setup语法糖
date: 2022-04-24 17:13:00
permalink: /pages/4b0a99/
categories:
  - 前端
  - Vue3
  - Vue
tags:
  - Vue3
  - Vue
---



## 简介

我们先来体验一下语法糖的便捷：

<code-group>
  <code-block title="未使用语法糖" active>
  
  <<< @/codes/vue-demo/pages/vue3/setup-candy/export-property/old.vue

  </code-block>

  <code-block title="使用语法糖">

  <<<@/codes/vue-demo/pages/vue3/setup-candy/export-property/index.vue
  
  </code-block>
</code-group>

你可以直接将整个`<script setup></script>`看作是`setup函数`，在**由setup包装的script中**
1.  直接声明的变量会被自动暴露到`template`中，可以直接使用，可以免去在`export default`中声明
2.  import导入的组件和函数不需要在`components和method`中注册，可以直接使用。
3.  我们不需要再主动通过`export default`导出当前组件，`setup语法糖`帮助我们自动完成了这一工作



## defineEmits

如果你刚从React转过来或是Vue新手，请先阅读[emit](/pages/01162a/)。

Vue3中推荐我们对子组件暴露出的`emit`进行声明，[（为什么要进行声明）](/pages/6973ba/#emit)，我们先来看看不使用`setup语法糖`要怎么声明：

<<< @/codes/vue-demo/pages/vue3/setup-candy/emit/old/button.vue

:::tip
`emits`接收数组和对象作为参数，官网介绍**对象的声明方式**可以对`emits`出的函数进行校验。

但事实上，校验不通过只会在控制台打印`Vue warn`，并不会阻止函数的执行。

因暂时没查到应用场景，这里只介绍数组的声明方式。
:::

然后简单的用`defineEmits`来替代`emits`:

```js
defineEmits(['parentMethod'])
```

需要注意的是，在`defineEmits`中使用局部变量会导致编译报错，官方给出的解释是：因为`defineEmits`的参数会在`setup函数`外进行读取（提升到模块的范围）。

```js
const str = 'parentMethod'
defineEmits([str])

//报错： [vite] Internal server error: [@vue/compiler-sfc] defineProps() in <script setup> cannot reference locally declared variables because it will be hoisted outside of the setup() function. If your component options require initialization in the module scope, use a separate normal <script> to export the options instead.
```

如果你需要使用变量，可以用`import`导入相关变量，其同样也会被提升到模块的范围。

```js
export const emitName = 'parentMethod'
```

<<< @/codes/vue-demo/pages/vue3/setup-candy/emit/button.vue

#### ts

`Vue3` 推荐使用`TypeScript`进行类型判断，`defineEmits`的TS接口类型为:
```js
export declare function defineEmits<TypeEmit>(): TypeEmit;
```

我们需要通过**泛型**传入`emits`方法的状态声明，再进行调用。即：

```js
defineEmits<{
  (参数1 : '函数名', 参数2 : 类型 , ...) : 函数返回值
}>()
```

改写一下我们刚才的例子：

```js
defineEmits<{
  (e: 'parentMethod', num: number): void
}>()
```


## defineProps

在`Vue2`中，我们习惯在导出项目的时候声明`props`对象:

<<< @/codes/vue-demo/pages/vue3/setup-candy/props/old/my-button.vue{3,8-12}

而在`Vue3`中，借助`setup语法糖`，我们要做的是在项目初始化时声明props对象,我们使用`defineProps`来获取props对象

<<< @/codes/vue-demo/pages/vue3/setup-candy/props/my-button.vue{3,8-12}
