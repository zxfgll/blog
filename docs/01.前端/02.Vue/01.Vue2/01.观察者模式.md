---
title: 观察者模式
date: 2022-04-25 19:20:05
permalink: /pages/984d41/
categories:
  - 前端
  - Vue
  - Vue2
tags:
  - 
---

# 观察者模式

流程：
1. `观察者`订阅`观察目标`
2. `观察目标`通知`观察者`，`观察者`进行处理

设计：
-   `观察者`接受一个函数作为参数，在被通知时执行。
-   `观察目标`拥有一个`addObserver`方法，用于绑定`观察者`
-   `观察目标`拥有一个`notify`方法，用于通知`观察者`
-   `观察目标`维护一个`观察者列表ObserverList`，在`notify`中通知所有`观察者`

<<< @\codes\javaScript\observer-model\basic.js

# 模拟渲染

-  观察者：`render`函数
-  观察目标：`data`数据

流程：
1.  `render`函数订阅`data`数据
2.  `data`数据发生变更时,通知`render`，执行`render`函数

设计：
-   采用`wrapper`包裹`data`使其成为可观测对象，wrapper用`Object.defineProperty`来实现，使`data`发生改变时能够通知`观察者`
-   对于没有变更的`data属性`不应该触发渲染，所以需要转换每一个`data`对象的子属性成为观察目标，包括`嵌套对象`。使用递归来实现。

核心函数`wrapper`，转化`data`为可观测对象

<<< @\codes\javaScript\observer-model\render.js#wrapper

整体实现：

<<< @\codes\javaScript\observer-model\render.js


# Vue的观察者模式

要学习Vue的观察者模式，我们还需要一些关于`闭包`的知识。

前方的区域以后再来探索吧...

https://www.cnblogs.com/moon3/p/12200807.html
https://juejin.cn/post/6844903901003513863
https://juejin.cn/post/7049359043936288805

<!-- -   观察目标:`Dep`，`每个数据对象`都绑定一个`Dep实例`
    -   `Dep`拥有一个`subs队列`，存储着`观察者列表`
    -   `Dep`拥有一个`notify`方法，用于通知观察者
    -   辅助类：`Observer`，将观察目标转化为`可观测数据`，生成`Dep实例`
-   观察者：`Watcher`，将`每个响应式函数（如render）`包装成一个`Watcher`实例 -->

