## 查询

### 查询所有行：

```sql
SELECT * FROM <表名>
```

::: tip
`SELECT 1 ;` 可以用来测试数据库连接
:::

### 条件查询

**IF：**

`SELECT * FROM <表名> WHERE <条件表达式>`

```sql
SELECT * FROM students WHERE score >= 80
```

**与：**

`SELECT * FROM <表名> WHERE <条件一> AND <条件二>`

```sql
SELECT * from students WHERE class_id = 1 AND SCORE >= 80
```
::: tip
sql中没有赋值和变量，可以直接用`=`代表等号
:::

**或：**

`SELECT * FROM <表名> WHERE <条件一> OR <条件二>`

**非：**

`SELECT * FROM <表名> WHERE NOT <条件一>`

更常用的： `SELECT * FROM <表名> WHERE class_id <> 2`  等于 `SELECT * FROM <表名> WHERE NOT class_id = 2`   **将=换成`<>`表示不等**

#### 优先级

NOT > AND > OR , 加上括号可以改变优先级；例：

```sql
-- 分数小于80或大于90的男性
SELECT * FROM students WHERE (score < 80 OR score > 90) AND gender = 'M'; 
-- 分数小于80或 分数大于90且是男性
SELECT * FROM students WHERE score < 80 OR score > 90 AND gender = 'M'; 
```

因为 `AND` 大于 `OR` ， 所以在第二个表达式中，会优先计算后面的式子。


#### 运算符

**a BETWEEN x AND y**，取某一个区间，等价于 `a >= x + a <= y`

以下两种写法等价：
```sql
WHERE score BETWEEN 60 AND 90
WHERE score >= 60 AND score <= 90
```

**LIKE + %**: 判断字符串是否相似， `%` 可以代替任意字符

例：
```sql
SELECT * FROM students WHERE NAME LIKE "%明" -- 小明 
```


### 投影查询

当我们查询时，使用 `SELECT * FROM` 会将匹配数据的所有信息（所有列）查询出来,比如我们想将所有 `K` 开头的城市筛选出来：

```sql
SELECT * 
FROM CITY 
WHERE NAME LIKE "K%";
```


![](https://linyc.oss-cn-beijing.aliyuncs.com/20220614135738.png)

但是假设我们只需要某几列呢？例如我们只想要 `CountryCode` 和 `District` 两行数据，这时我们的查询被叫做 **投影查询**, 我们只需简单的将列名用逗号分隔放在 `SELECT` 后面即可

```sql
SELECT CountryCode,District 
FROM CITY 
WHERE NAME LIKE "K%";
```

![](https://linyc.oss-cn-beijing.aliyuncs.com/20220614140032.png)


### 排序

在 `WHERE` 语句后面加上 `ORDER BY 列名`，默认正序，倒叙为 `ORDER BY 列名 DESC`

```SQL
SELECT CountryCode,District 
FROM CITY 
WHERE NAME LIKE "K%" 
ORDER BY CountryCode;
```

![](https://linyc.oss-cn-beijing.aliyuncs.com/20220614142334.png)

如果有相同值我们可以按其他列作为进一步排序的依据，将排序语句逗号隔开，比如我们先按国家编码正序排列，再按区域名倒叙排列：

```sql
SELECT CountryCode,District 
FROM CITY 
WHERE NAME LIKE "K%" 
ORDER BY CountryCode,District DESC;
```

### 分页查询

`LIMIT 一页多少记录 OFFSET 从第几条记录开始查`

```SQL
SELECT CountryCode,District
FROM CITY 
WHERE NAME LIKE "K%" 
ORDER BY CountryCode,District DESC
LIMIT 10 OFFSET 0;
```

### 聚合查询

为了统计一张表的数据量，SQL提供了专门的聚合函数，`COUNT(* 或列名)`用于查询一共有多少条记录：：

```sql
SELECT COUNT(*) 
FROM CITY 
```

其他聚合函数：
-   **SUM**: 计算某列合计值，必须是数值类型
-   **AVG**: 计算某列平均值，必须是数值类型
-   **MAX**: 计算某列最大值，若不是数值，返回最后一条数据
-   **MIN**: 计算某列最小值，若不是数值，返回第一条数据

#### 聚合分组

假如我们要统计每个国家分别有多少城市，我们可以：

```sql
SELECT COUNT(*),CountryCode FROM CITY WHERE CountryCode = 'CHN'
SELECT COUNT(*),CountryCode FROM CITY WHERE CountryCode = 'USA'
...
```

但我们不可能一个个手动统计所有国家：我们应该使用 `GROUP BY` 标识符：

```sql
SELECT COUNT(*),CountryCode
FROM CITY
GROUP BY CountryCode
```

![](https://linyc.oss-cn-beijing.aliyuncs.com/20220614162828.png)


